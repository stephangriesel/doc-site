---
title: Contentful ❤ Gatsby
slug: contentful
image: ./img/contentfullogo.png
date: 2016-05-18
author: Stephan
---

### Assumptions

- Your Gatsby site is set up already, if not refer to the [Gatsby post](https://doc.stephangriesel.com/gatsby).

### Set up content model

- Go to "Content model" in dashboard & add new "content type"
- Add content types as you please

### Connect Contentful

**Install Plugin**

- Go to Gatsbyjs.org and get details on the [plugin](https://www.gatsbyjs.org/packages/gatsby-source-contentful/) & install.
- Copy Delivery API object & add to gatsby-config.js

```
    {
      resolve: `gatsby-source-contentful`,
      options: {
        spaceId: `your_space_id`,
        // Learn about environment variables: https://gatsby.dev/env-vars
        accessToken: process.env.CONTENTFUL_ACCESS_TOKEN,
      },
    },
```

**Set up environment variables & copy keys from Contentful dashboard**

1. Create .env.development \* .env.production in root
2. Add sensitive data in this the new .env files create, example: CONTENTFUL_ACCESS_TOKEN=yoursecretkey
3. Require **dotenv** in gatsby.config

```
require('dotenv').config({
  path: `.env.${process.env.NODE_ENV}`,
})
```

4. Add variable to config:

```
accessToken: process.env.CONTENTFUL_ACCESS_TOKEN
```

### Add query

Go to GraphiQL or Playground and test query. Once data received copy query. If images are used remember to update image source with [Gatsby Image Fragment](https://www.gatsbyjs.org/packages/gatsby-image/?=#fragments)

### Set up layout & components

**Create Components**

- Layout
- Header
- Footer

In the index.js file wrap your _layout_ component around child elements

```
layout.js
---
const layout = ({children}) => {
  return (
    <>
      <Navbar />
      <main>{children}</main>
      <Footer />
    </>
  )
}
```

### Render Data

```
const PostsPageComponent = ({ data }) => {
    const { allContentfulPost: { nodes: posts },
    } = data
    console.log("<<POSTS>>")
    console.log(posts);
    return (
        <Layout>
            <section>
                {posts.map(post => {
                    console.log(post)
                    return <article key={post.id}>
                        <Image fluid={post.image.fluid} alt={post.title}></Image>
                        <h1>{post.title}</h1>
                        <Link to={`/posts/${post.slug}`}>Read more</Link>
                    </article>
                })}
            </section>
        </Layout>
    )
}
```

### Set up template

Create new _template_ folder inside src with template file inside, in this example **post-template.js**

### Slug

Back in GraphiQL or Playground test your query for all products to get your slug:

```
query MyQuery {
  allContentfulPost {
    nodes {
      slug
    }
  }
}
```
